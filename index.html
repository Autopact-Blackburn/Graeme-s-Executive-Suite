<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Graeme's — Executive Performance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg:#070a14;
  --card:#0e1425;
  --card-alt:#1a2237;
  --text:#e9ecf4;
  --muted:#9aa3b8;
  --border:#26304a;
  --accent:#00c2ff;
  --accent-soft:#00c2ff55;
}

body {
  margin:0;
  background:var(--bg);
  font-family:system-ui,sans-serif;
  color:var(--text);
  padding-bottom:40px;
}

.header {
  background:linear-gradient(90deg,#00c2ff22,#00c2ff11,#0000);
  padding:18px 16px 12px;
  border-bottom:1px solid var(--border);
}

.header-title {
  font-size:26px;
  text-align:center;
  font-weight:700;
  color:var(--accent);
}

.header-sub {
  text-align:center;
  font-size:12px;
  color:var(--muted);
}

.toggle-row {
  text-align:center;
  margin-top:12px;
}

.toggle-btn {
  display:inline-block;
  padding:7px 16px;
  margin:0 4px;
  border-radius:20px;
  border:1px solid var(--border);
  cursor:pointer;
  background:var(--card);
  color:var(--muted);
}

.toggle-btn.active {
  background:var(--accent);
  color:#000;
  font-weight:600;
}

.section-title {
  margin:22px 15px 10px;
  font-size:18px;
  color:var(--accent);
}

.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
  padding:0 15px;
}

.tile {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
}

.metric {
  font-size:24px;
  font-weight:700;
}

.label {
  font-size:13px;
  color:var(--muted);
}
</style>
</head>

<body>

<div class="header">
  <div class="header-title">Graeme's — Executive Dashboard</div>
  <div class="header-sub" id="dateLabel">Loading…</div>

  <div class="toggle-row">
    <span id="btnDaily" class="toggle-btn active">DAILY</span>
    <span id="btnMtd" class="toggle-btn">MTD</span>
  </div>
</div>

<div id="summary"></div>
<script>
/* ===============================
   SUPABASE (SAFE — NO supabase VAR)
   =============================== */
const sb = window.supabase.createClient(
  "https://ecldmrzlfexinvyyilpi.supabase.co",
  "sb_publishable_8E6BQ2E2-uNz2O3W9TqdQQ_aOC_GXVz"
);

let mode = "daily";
let dashData = null;

const money = v =>
  "$" + Number(v || 0).toLocaleString("en-AU", { maximumFractionDigits: 0 });

function getDates() {
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return {
    today: `${y}-${m}-${day}`,
    start: `${y}-${m}-01`
  };
}

async function loadDashboardData() {
  const { today, start } = getDates();
  document.getElementById("dateLabel").textContent = `Data for ${today}`;

  const { data: sales } = await sb
    .from("sales_reports")
    .select("*")
    .gte("date", start)
    .lte("date", today);

  const { data: service } = await sb
    .from("service_reports")
    .select("*")
    .gte("date", start)
    .lte("date", today);

  let totals = {
    dailyLeads:0, mtdLeads:0,
    dailySales:0, mtdSales:0,
    dailyRos:0, mtdRos:0,
    dailyGross:0, mtdGross:0
  };

  (sales || []).forEach(r => {
    totals.mtdLeads += r.leads || 0;
    totals.mtdSales += r.sales || 0;
    if (r.date === today) {
      totals.dailyLeads += r.leads || 0;
      totals.dailySales += r.sales || 0;
    }
  });

  (service || []).forEach(r => {
    const ros = (r.customer_ros || 0) + (r.warranty_ros_today || 0);
    totals.mtdRos += ros;
    totals.mtdGross += r.gross_today || 0;
    if (r.date === today) {
      totals.dailyRos += ros;
      totals.dailyGross += r.gross_today || 0;
    }
  });

  dashData = totals;
  renderSummary();
}
<script>
function renderSummary() {
  if (!dashData) return;

  const leads = mode === "daily" ? dashData.dailyLeads : dashData.mtdLeads;
  const sales = mode === "daily" ? dashData.dailySales : dashData.mtdSales;
  const ros = mode === "daily" ? dashData.dailyRos : dashData.mtdRos;
  const gross = mode === "daily" ? dashData.dailyGross : dashData.mtdGross;

  document.getElementById("summary").innerHTML = `
    <div class="section-title">Group Summary</div>
    <div class="grid">
      <div class="tile">
        <div class="metric">${leads}</div>
        <div class="label">Leads</div>
      </div>
      <div class="tile">
        <div class="metric">${sales}</div>
        <div class="label">Sales</div>
      </div>
      <div class="tile">
        <div class="metric">${ros}</div>
        <div class="label">ROs</div>
      </div>
      <div class="tile">
        <div class="metric">${money(gross)}</div>
        <div class="label">Gross</div>
      </div>
    </div>
  `;
}

document.getElementById("btnDaily").onclick = () => {
  mode = "daily";
  btnDaily.classList.add("active");
  btnMtd.classList.remove("active");
  renderSummary();
};

document.getElementById("btnMtd").onclick = () => {
  mode = "mtd";
  btnMtd.classList.add("active");
  btnDaily.classList.remove("active");
  renderSummary();
};

loadDashboardData();
</script>

</body>
</html>
